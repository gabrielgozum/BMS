/**
 * @brief BMS Parameters
 *
 * This file includes constant variabls to be used by the BMS Application. It
 * includes Lookup Tables.
 *
 * Future Work: This file will be generated using a matlab script.
 *
 */

#include <stdbool.h>
#include <stdint.h>
#include "lookup.h"
#include "params.h"

//-----------------------------------------------------------------------------
// SOC LUT based on OCV
//-----------------------------------------------------------------------------

static const float SOC_LUT_VALS[] = { 0, 0.0298, 0.0607, 0.0940, 0.1353, 0.1784,
                                      0.2432, 0.3222, 0.3865, 0.4679, 0.5583,
                                      0.6414, 0.7157, 0.7875, 0.9396, 1.0000 }; //!< LUT for SOC from OCV

const lut_1d_t SOC_LUT =
{
    16,             // len ocv
    3.0822,         // in ocv
    0.07319,        // step ocv

    SOC_LUT_VALS
}; //!< LUT Struct for SOC

//-----------------------------------------------------------------------------
// OCV LUT based on SOC
//-----------------------------------------------------------------------------
static const float OCV_LUT_VALS[] = { 3.10172, 3.21309, 3.31932, 3.40333,
                                      3.48734, 3.52822, 3.56910, 3.628005,
                                      3.68691, 3.730045, 3.77318, 3.811165,
                                      3.84915, 3.898395, 3.94764, 3.99818,
                                      4.04872, 4.068995, 4.08927, 4.11181,
                                      4.17812 };

const lut_1d_t OCV_LUT =
{
 21,    // len soc
 0,     // in soc
 0.05,  // step soc
 OCV_LUT_VALS
}; //!< LUT Struct for OCV

//-----------------------------------------------------------------------------
// Cell Charge Resistance LUT based on SOC and Cell Temperature
//-----------------------------------------------------------------------------

static const float CT_CH_LUT_VALS[] = {
    0.004834,0.003315,0.002889,0.002651,0.002555,0.002564,0.002758,
    0.004176,0.002917,0.002598,0.002446,0.002383,0.002411,0.002531,
    0.003736,0.002708,0.002447,0.002324,0.002286,0.002329,0.002444,
    0.003487,0.002591,0.002357,0.002254,0.002228,0.002277,0.002392,
    0.003239,0.002473,0.002268,0.002185,0.002170,0.002225,0.002341,
    0.003139,0.002437,0.002244,0.002159,0.002140,0.002190,0.002306,
    0.003039,0.002402,0.002221,0.002132,0.002111,0.002156,0.002272,
    0.003013,0.002395,0.002218,0.002134,0.002111,0.002158,0.002267,
    0.002988,0.002388,0.002216,0.002136,0.002111,0.002160,0.002261,
    0.002988,0.002392,0.002222,0.002138,0.002116,0.002161,0.002261,
    0.002989,0.002396,0.002227,0.002141,0.002122,0.002162,0.002260,
    0.002997,0.002396,0.002219,0.002135,0.002115,0.002156,0.002253,
    0.003004,0.002397,0.002211,0.002129,0.002109,0.002150,0.002245,
    0.003032,0.002420,0.002238,0.002152,0.002131,0.002168,0.002260,
    0.003060,0.002444,0.002266,0.002175,0.002154,0.002186,0.002275,
    0.003151,0.002480,0.002293,0.002201,0.002172,0.002201,0.002287,
    0.003242,0.002517,0.002319,0.002226,0.002189,0.002216,0.002298,
    0.004886,0.002961,0.002343,0.002234,0.002190,0.002214,0.002297,
    0.006530,0.003405,0.002367,0.002242,0.002191,0.002212,0.002296,
    0.008015,0.005642,0.005054,0.004510,0.004006,0.004059,0.004822,
    0.008730,0.006435,0.005731,0.005513,0.005075,0.004802,0.004973
}; //!< LUT for Charge Resistance

const lut_2d_t CR_CH_LUT =
{
    21,     // len soc
    7,      // len ct

    0,      // in soc
    0.05,      // step soc

    15,     // in ct
    10,     // step ct

    CT_CH_LUT_VALS
}; //!< LUT Struct for Charge Resistance

//-----------------------------------------------------------------------------
// Cell Discharge Resistance LUT based on SOC and Cell Temperature
//-----------------------------------------------------------------------------

static const float CR_DCH_LUT_VALS[] = {
    0.006411,0.003338,0.002833,0.002576,0.002473,0.002484,0.002629,
    0.004619,0.002871,0.002543,0.002382,0.002339,0.002360,0.002474,
    0.003827,0.002667,0.002414,0.002291,0.002248,0.002291,0.002398,
    0.003523,0.002551,0.002326,0.002213,0.002183,0.002234,0.002350,
    0.003220,0.002435,0.002237,0.002135,0.002119,0.002178,0.002301,
    0.003103,0.002418,0.002229,0.002137,0.002119,0.002171,0.002275,
    0.002987,0.002401,0.002221,0.002139,0.002119,0.002165,0.002248,
    0.002963,0.002390,0.002216,0.002137,0.002117,0.002164,0.002256,
    0.002938,0.002380,0.002211,0.002134,0.002115,0.002163,0.002263,
    0.002936,0.002377,0.002206,0.002126,0.002106,0.002150,0.002251,
    0.002933,0.002374,0.002201,0.002117,0.002097,0.002137,0.002238,
    0.002936,0.002371,0.002197,0.002113,0.002091,0.002131,0.002230,
    0.002939,0.002367,0.002193,0.002109,0.002084,0.002126,0.002222,
    0.002987,0.002393,0.002213,0.002126,0.002101,0.002137,0.002234,
    0.003035,0.002419,0.002232,0.002143,0.002117,0.002147,0.002247,
    0.003102,0.002441,0.002246,0.002153,0.002124,0.002154,0.002248,
    0.003169,0.002463,0.002260,0.002164,0.002130,0.002161,0.002248,
    0.003296,0.002525,0.002309,0.002200,0.002154,0.002180,0.002271,
    0.003422,0.002588,0.002358,0.002236,0.002178,0.002199,0.002294,
    0.003558,0.002656,0.002401,0.002272,0.002216,0.002232,0.002313,
    0.003814,0.002788,0.002484,0.002388,0.002245,0.002234,0.002308
}; //!< LUT for Discharge Resistance

const lut_2d_t CR_DCH_LUT =
{
     21,     // len soc
     7,      // len ct

     0,      // in soc
     0.05,   // step soc

     15,     // in ct
     10,     // step ct

     CR_DCH_LUT_VALS
}; //!< LUT Struct for Discharge Resistance


//-----------------------------------------------------------------------------
// Cell Temperature LUT Based on the sensor voltage
//-----------------------------------------------------------------------------

// static const float CT_LUT_VALS[] = { 120.000000, 95.000000, 80.000000,
//                                      70.000000, 61.666667, 55.000000, 48.750000,
//                                      43.000000, 38.333333, 34.166667, 30.000000,
//                                      25.833333, 21.666667, 17.857143, 14.166667,
//                                      10.000000, 5.833333, 1.666667, -2.500000,
//                                      -7.500000, -13.000000, -20.000000,
//                                      -30.000000 };

// const lut_1d_t CT_LUT =
// {
//      23,            // length temperatures
//      1.3,           // in sensor voltage
//      0.05,          // step sensor voltage
//      CT_LUT_VALS
// };

// updated temperatres for 220.1 BSB with GA10K3A1A thermistor
static const float CT_LUT_VALS[] = { 125,71555, 98.5600, 83.8151, 73.6819, 65.9218,
                                     59.5899, 54.2010, 49.4734, 45.2287, 41.3467,
                                     37.7415, 34.3495, 31.1208, 28.0156, 25.0000,
                                     22.0442, 19.1206, 13.2023, 13.2618, 10.2687,
                                     7.1882, 3.9778, 0.5820, -3.0755, -7.1080};

const lut_1d_t CT_LUT =
{
     25,            // length temperatures
     0.1,           // in sensor voltage
     0.1,          // step sensor voltage
     CT_LUT_VALS
};
